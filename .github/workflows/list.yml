- name: رفع إلى Internet Archive (نفس الصفحة دايماً)
        env:
          S3_ACCESS_KEY: ${{ secrets.S3_ACCESS_KEY }}
          S3_SECRET_KEY: ${{ secrets.S3_SECRET_KEY }}
        run: |
          python - <<EOF
          from internetarchive import upload, get_item
          import os
          from datetime import date

          # ← غير ده لاسم ثابت تحبه (حروف صغيرة، - أو _ فقط)
          FIXED_IDENTIFIER = "m3u8-live-recordings-mohamed"  

          file_path = "${{ env.output_file }}"

          # عنوان الفيديو داخل الصفحة (هيظهر في القائمة)
          file_title = "${{ inputs.title }}" or f"تسجيل {date.today().strftime('%Y-%m-%d')} - ${{ inputs.duration_minutes }} دقيقة"

          # metadata عامة للـ item (بتطبق مرة واحدة بس)
          metadata = {
              'title': 'تسجيلات بث مباشر m3u8 - مجموعة',
              'description': 'مجموعة تسجيلات من بثوث m3u8 مختلفة',
              'mediatype': 'movies',
              'collection': 'opensource_movies',
              'subject': 'livestream;m3u8;recording;playlist'
          }

          print(f"جاري الرفع إلى: {FIXED_IDENTIFIER}")

          # الرفع (لو الـ item موجود → بيضيف الملف، لو مش موجود → بيعمله)
          r = upload(
              FIXED_IDENTIFIER,
              files=[{'name': file_path, 'title': file_title}],  # ← مهم: title لكل ملف
              metadata=metadata,   # بيتجاهل لو الـ item موجود أصلاً
              access_key=os.environ['S3_ACCESS_KEY'],
              secret_key=os.environ['S3_SECRET_KEY'],
              verbose=True
          )

          if r and r[0].status_code in [200, 201]:
              print("تم الرفع بنجاح ✓")
          else:
              print("فشل الرفع:", r)

          with open(os.environ['GITHUB_ENV'], 'a') as f:
              f.write(f"identifier={FIXED_IDENTIFIER}\n")
          EOF